#!/usr/bin/env bash
#
# Looks for a local file called writedirs.txt and attempts to make the list of directories it contains writeable recursively.
#
#  beporter@users.sourceforge.net

# Relative to the app's root folder.
DIRLISTFILE=writedirs.txt

#TODO: In future versions, the script could look for an argument ($1) or an environment variable to control which file to read from instead of the hardcoded value above. This would make it more compatible with the updatewritedirs script.

DIR="$( cd -P "$( dirname "$0" )"/.. && pwd )";
CONFIG_DIR="$DIR/Config";

# Find any writeable dirs (only root dirs) and append them (for now) to the writedirs.txt file.
find $DIR -perm -20 -type d -prune -print | sed "s%^${DIR}/%%" >> $CONFIG_DIR/$DIRLISTFILE

# Then filter out any duplicates. This has the effect of preserving any existing "placeholder" entries previously in the file, but not found in the current app dir.
sort $CONFIG_DIR/$DIRLISTFILE | uniq > $CONFIG_DIR/$DIRLISTFILE.tmp
rm $CONFIG_DIR/$DIRLISTFILE
mv $CONFIG_DIR/$DIRLISTFILE.tmp $CONFIG_DIR/$DIRLISTFILE
